<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zama FHE Terminal - Fully Homomorphic Encryption (FHE) Secure Auction</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* CSS Styles - Giữ nguyên phong cách terminal */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'VT323', monospace; background-color: #000000; color: #00ff00; min-height: 100vh; padding: 20px; font-size: 18px; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 40px; animation: fadeIn 1s ease-out; }
        h1 { font-size: 3em; margin-bottom: 5px; text-shadow: 0 0 5px #00ff00, 0 0 15px rgba(0, 255, 0, 0.8); }
        .subtitle { font-size: 1.2em; opacity: 0.9; }

        .product-layout { background-color: #050505; border: 2px solid #ffff00; padding: 25px; margin-bottom: 30px; box-shadow: 0 0 15px rgba(255, 255, 0, 0.4); }
        .product-layout h2 { font-size: 2em; color: #ffff00; border-bottom: 2px solid #00ff00; padding-bottom: 10px; margin-bottom: 15px; }
        .product-details { display: flex; gap: 20px; align-items: flex-start; }
        .product-image-container { flex-shrink: 0; width: 200px; height: 150px; background: #111; border: 1px solid #00ff00; overflow: hidden; position: relative; }
        .product-image { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; }
        .product-info { flex-grow: 1; line-height: 1.4; }
        .product-info strong { color: #00ff00; }

        .main-grid { display: grid; grid-template-columns: 1fr; gap: 30px; margin-bottom: 30px; }
        .card { background-color: #000000; border: 2px solid #00ff00; padding: 25px; box-shadow: 0 0 10px rgba(0, 255, 0, 0.5); animation: fadeInUp 1s ease-out; }
        .card h2 { margin-bottom: 20px; font-size: 1.8em; color: #ffff00; border-bottom: 1px dashed #00ff00; padding-bottom: 5px; display: flex; align-items: center; gap: 10px; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #00ff00; background: #000; color: #00ff00; font-size: 1em; font-family: 'VT323', monospace; margin-bottom: 15px; caret-color: #ffff00; box-shadow: 0 0 5px rgba(0, 255, 0, 0.2); transition: border-color 0.2s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #ffff00; box-shadow: 0 0 8px #ffff00; }
        button { background: #000; border: 2px solid #00ff00; padding: 12px 20px; color: #00ff00; font-size: 1.1em; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; transition: all 0.2s ease; font-family: 'VT323', monospace; letter-spacing: 1px; text-transform: uppercase; }
        button:hover { background: #00ff00; color: #000000; box-shadow: 0 0 15px #00ff00; }
        button:disabled { opacity: 0.4; cursor: not-allowed; background: #000; color: #00ff00; box-shadow: none; }
        .auction-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .info-item { background: #0a0a0a; padding: 15px; border: 1px solid #00ff00; text-align: center; }
        .info-label { font-size: 0.9em; opacity: 0.8; margin-bottom: 5px; }
        .info-value { font-size: 1.5em; font-weight: bold; color: #ffff00; }
        .wallet-status { padding: 15px; background: #0a0a0a; border: 1px dashed #00ff00; margin-bottom: 20px; text-align: left; }
        .fhe-badge { display: inline-block; background: #00ff00; color: #000; padding: 3px 8px; font-size: 0.8em; font-weight: bold; text-transform: uppercase; margin-left: 10px; border: 1px solid #00ff00; box-shadow: 0 0 5px #00ff00; }
        .encrypted-badge { display: flex; align-items: center; gap: 10px; background: #111; padding: 10px; border: 1px solid #00ff00; margin-top: 10px; font-size: 0.9em; }
        .tx-monitor { grid-column: 1 / -1; }
        .tx-container { height: 300px; background: #0a0a0a; border: 1px solid #00ff00; overflow-y: auto; padding: 10px; line-height: 1.4; white-space: pre-wrap; position: relative; }
        .log-pending { color: orange; }
        .log-confirmed { color: #00ff00; }
        .log-failed { color: #ff0000; }
        .cancel-btn { background: darkred; border-color: red; color: #fff; }
        .cancel-btn:hover { background: red; box-shadow: 0 0 15px red; }
        .pause-btn { background: darkblue; border-color: blue; color: #fff; }
        .pause-btn:hover { background: blue; box-shadow: 0 0 15px blue; }
        .refund-section { margin-top: 20px; }
        .bidders-list { max-height: 200px; overflow-y: auto; background: #0a0a0a; border: 1px solid #00ff00; padding: 10px; }
        .bidders-list p { margin: 5px 0; opacity: 0.8; }
        .owner-section { border-top: 2px solid #ffff00; padding-top: 20px; margin-top: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @media (min-width: 768px) { .main-grid { grid-template-columns: 2fr 3fr; } .tx-monitor { grid-column: 1 / 3; } .product-details { flex-direction: row; } }
        @media (max-width: 767px) { .product-details { flex-direction: column; } .product-image-container { width: 100%; height: 200px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>[SYSTEM ONLINE] ZAMA FHE AUCTION $</h1>
            <p class="subtitle">Fully Homomorphic Encryption (FHE) Secure Auction - Sepolia Testnet Ready.</p>
        </header>

        <div class="product-layout">
            <h2>> AUCTION ITEM: **CRYPTIC KEY**</h2>
            <div class="product-details">
                <div class="product-image-container">
                    <img id="productImage" class="product-image" src="https://raw.githubusercontent.com/Quangx199x/SYSTEM-ONLINE---ZAMA-FHE-AUCTION/refs/heads/main/key.jpeg" alt="Sản phẩm đấu giá">
                </div>
                <div class="product-info">
                    <p><strong>Description:</strong> Encrypted Golden Key NFT (euint64 bid).</p>
                    <p><strong>Conditions:</strong> Bid must be in **Wei** and less than 18 ETH (due to `euint64` limit). Winning bid transferred to Beneficiary.</p>
                </div>
            </div>
        </div>
        
        <div class="main-grid">
            
            <div class="card wallet-section">
                <h2>> INIT WALLET SERVICE & FHE SDK</h2>
                <div class="wallet-status" id="walletStatus">
                    <p class="log-line log-info">[STATUS] Wallet: DISCONNECTED</p>
                    <p class="log-line log-info">[NETWORK] Target Network: **Sepolia (11155111)**</p>
                    <p class="log-line log-pending" id="fheStatus">[FHE SDK] Initializing FHE WASM files...</p>
                </div>
                <button id="connectBtn">
                    > CONNECT WALLET & INIT FHE
                </button>
            </div>

            <div class="card">
                <h2>> AUCTION DATA FEED (FHE PROTECTED)</h2>
                <div class="auction-info">
                    <div class="info-item">
                        <div class="info-label">Current Round</div>
                        <div class="info-value" id="currentRound">#1</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Time Remaining</div>
                        <div class="info-value" id="timeLeft">--:--:--</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Min Deposit</div>
                        <div class="info-value" id="minDepositValue">-- ETH</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Highest Bid</div>
                        <div class="info-value" id="currentBid">CIPHERTEXT</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Lead Bidder</div>
                        <div class="info-value" id="leadBidder">0x0000...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Status</div>
                        <div class="info-value" id="auctionStatus">ACTIVE</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Total Fees</div>
                        <div class="info-value" id="totalFees">0 ETH</div>
                    </div>
                </div>
                
                <div id="ownerActions" style="display: none; margin-top: 20px;">
                    <button id="updateBeneficiaryBtn" disabled>
                        > UPDATE BENEFICIARY (OWNER ONLY)
                    </button>
                    <input type="text" id="newBeneficiary" placeholder="New beneficiary address">
                    <button id="updateFeeCollectorBtn" disabled>
                        > UPDATE FEE COLLECTOR (OWNER ONLY)
                    </button>
                    <input type="text" id="newFeeCollector" placeholder="New fee collector address">
                    <button id="finalizeBtn" disabled>
                        > REQUEST FINALIZE & REVEAL WINNER (OWNER ONLY)
                    </button>
                    <button id="pauseBtn" class="pause-btn" disabled>
                        > PAUSE AUCTION (OWNER ONLY)
                    </button>
                    <button id="cancelDecryptionBtn" class="cancel-btn" disabled>
                        > CANCEL DECRYPTION (OWNER ONLY)
                    </button>
                    <button id="emergencyEndBtn" class="cancel-btn" disabled>
                        > EMERGENCY END (OWNER ONLY, +24H DELAY)
                    </button>
                    <button id="withdrawFeesBtn" disabled>
                        > WITHDRAW PLATFORM FEES (OWNER ONLY)
                    </button>
                    <button id="batchClaimBtn" disabled>
                        > BATCH CLAIM REFUNDS (OWNER ONLY)
                    </button>
                    <textarea id="claimantsList" placeholder="Enter addresses (one per line)" rows="3"></textarea>
                </div>
            </div>

            <div class="card">
                <h2>> FHE BID SUBMISSION</h2>
                <label for="bidAmount" class="log-line">[INPUT] Enter Bid Amount (ETH):</label>
                <input 
                    type="number" 
                    id="bidAmount" 
                    placeholder="ETH value (e.g., 0.001)" 
                    step="0.001"
                    min="0"
                >
                <label for="depositAmount" class="log-line">[INPUT] Enter Deposit (ETH):</label>
                <input 
                    type="number" 
                    id="depositAmount" 
                    placeholder="ETH deposit (must be >= Min Deposit)" 
                    step="0.001"
                    min="0"
                >
                <div class="encrypted-badge">
                    <span>Your bid will be encrypted using **euint64** and signed using **EIP712** before submission.</span>
                </div>
                <button id="bidBtn" disabled>
                    > SUBMIT ENCRYPTED BID $ (Sepolia)
                </button>
                <div class="refund-section">
                    <button id="cancelBidBtn" class="cancel-btn" disabled>
                        > CANCEL BID (REFUND DEPOSIT)
                    </button>
                    <button id="claimRefundBtn" disabled>
                        > CLAIM REFUND (IF AVAILABLE)
                    </button>
                    <div id="pendingRefund" style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                        Pending Refund: 0 ETH
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>> BIDDER INFO & ROUND BIDDERS</h2>
                <div id="bidderInfo">
                    <p>[INFO] Connect wallet to view bidder details.</p>
                </div>
                <div class="bidders-list" id="roundBidders">
                    <p>[LIST] Round bidders will appear here.</p>
                </div>
            </div>
            
            <div class="card tx-monitor">
                <h2>> LIVE TRANSACTION LOG <span class="fhe-badge">FHEVM</span></h2>
                <div class="tx-container" id="txContainer">
                    <p class="log-line"><span class="log-time">[00:00:00]</span> [CORE] System initialization complete. Awaiting FHE SDK...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script defer>
        
        // --- CONFIGURATION ---
        const CONTRACT_ADDRESS = '0x1cb2bbe021f9f3284fc325773e6eb80090fb520b'; 
        
        const SEPOLIA_CHAIN_ID = 11155111; 
        const EIP712_DOMAIN_NAME = "FHEAuction";
        const EIP712_DOMAIN_VERSION = "1";
        const EMERGENCY_DELAY_MS = 24 * 3600 * 1000; // 24 hours in ms

        // Updated FHE Auction ABI based on contract verification
        const FHE_AUCTION_ABI = [
            {"inputs":[{"internalType":"uint256","name":"_minDeposit","type":"uint256"},{"internalType":"address","name":"_pauserSet","type":"address"},{"internalType":"address","name":"_beneficiary","type":"address"},{"internalType":"address","name":"_gatewayContract","type":"address"},{"internalType":"address","name":"_feeCollector","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},
            {"inputs":[],"name":"AuctionAlreadyFinalized","type":"error"},
            {"inputs":[],"name":"AuctionNotActive","type":"error"},
            {"inputs":[],"name":"AuctionStillActive","type":"error"},
            {"inputs":[],"name":"BidAlreadyCancelled","type":"error"},
            {"inputs":[],"name":"CannotCancelAfterEnd","type":"error"},
            {"inputs":[],"name":"ContractPaused","type":"error"},
            {"inputs":[],"name":"DecryptionAlreadyPending","type":"error"},
            {"inputs":[],"name":"DecryptionNotTimedOut","type":"error"},
            {"inputs":[],"name":"ECDSAInvalidSignature","type":"error"},
            {"inputs":[{"internalType":"uint256","name":"length","type":"uint256"}],"name":"ECDSAInvalidSignatureLength","type":"error"},
            {"inputs":[{"internalType":"bytes32","name":"s","type":"bytes32"}],"name":"ECDSAInvalidSignatureS","type":"error"},
            {"inputs":[],"name":"EmergencyDelayNotMet","type":"error"},
            {"inputs":[],"name":"HandlesAlreadySavedForRequestID","type":"error"},
            {"inputs":[],"name":"InsufficientDeposit","type":"error"},
            {"inputs":[],"name":"InvalidAddress","type":"error"},
            {"inputs":[],"name":"InvalidAmount","type":"error"},
            {"inputs":[],"name":"InvalidDecryptionData","type":"error"},
            {"inputs":[],"name":"InvalidKMSSignatures","type":"error"},
            {"inputs":[],"name":"InvalidShortString","type":"error"},
            {"inputs":[],"name":"InvalidSignature","type":"error"},
            {"inputs":[],"name":"InvalidState","type":"error"},
            {"inputs":[],"name":"MaxBiddersReached","type":"error"},
            {"inputs":[],"name":"NoBidders","type":"error"},
            {"inputs":[],"name":"NoHandleFoundForRequestID","type":"error"},
            {"inputs":[],"name":"NoRefundAvailable","type":"error"},
            {"inputs":[],"name":"NoValidBids","type":"error"},
            {"inputs":[],"name":"ReentrancyGuardReentrantCall","type":"error"},
            {"inputs":[{"internalType":"string","name":"str","type":"string"}],"name":"StringTooLong","type":"error"},
            {"inputs":[],"name":"TransferFailed","type":"error"},
            {"inputs":[],"name":"Unauthorized","type":"error"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"newEndBlock","type":"uint256"}],"name":"AuctionExtended","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"indexed":true,"internalType":"address","name":"winner","type":"address"},{"internalType":"uint256","name":"finalBid","type":"uint256"},{"internalType":"uint256","name":"platformFee","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"AuctionFinished","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"oldBeneficiary","type":"address"},{"indexed":true,"internalType":"address","name":"newBeneficiary","type":"address"}],"name":"BeneficiaryUpdated","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"bidder","type":"address"},{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"uint256","name":"refundAmount","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"BidCancelled","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"bidder","type":"address"},{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"string","name":"reason","type":"string"},{"internalType":"uint256","name":"refundAmount","type":"uint256"}],"name":"BidInvalidated","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"bidder","type":"address"},{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"uint256","name":"depositAmount","type":"uint256"},{"internalType":"uint256","name":"blockNumber","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"BidPlaced","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"requestID","type":"uint256"}],"name":"DecryptionFulfilled","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"requestId","type":"uint256"},{"internalType":"bytes32[]","name":"handles","type":"bytes32[]"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"DecryptionRequested","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"requestId","type":"uint256"},{"internalType":"uint256","name":"timestamp","type":"uint256"}],"name":"DecryptionTimeout","type":"event"},
            {"anonymous":false,"inputs":[],"name":"EIP712DomainChanged","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"string","name":"reason","type":"string"}],"name":"EmergencyActivated","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"oldCollector","type":"address"},{"indexed":true,"internalType":"address","name":"newCollector","type":"address"}],"name":"FeeCollectorUpdated","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"collector","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"PlatformFeeCollected","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RefundAvailable","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"RefundClaimed","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"uint256","name":"endBlock","type":"uint256"},{"internalType":"uint256","name":"estimatedEndTime","type":"uint256"}],"name":"RoundStarted","type":"event"},
            {"anonymous":false,"inputs":[{"internalType":"enum FHEAuction.AuctionState","name":"from","type":"uint8"},{"internalType":"enum FHEAuction.AuctionState","name":"to","type":"uint8"}],"name":"StateChanged","type":"event"},
            {"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"uint256","name":"totalBids","type":"uint256"},{"internalType":"uint256","name":"validBids","type":"uint256"},{"internalType":"uint256","name":"invalidBids","type":"uint256"},{"internalType":"uint256","name":"maxBid","type":"uint256"},{"internalType":"uint256","name":"threshold","type":"uint256"}],"name":"ValidationSummary","type":"event"},
            {"stateMutability":"payable","type":"fallback"},
            {"inputs":[{"internalType":"address[]","name":"claimants","type":"address[]"}],"name":"batchClaimRefunds","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"externalEuint64","name":"encryptedBid","type":"bytes32"},{"internalType":"bytes","name":"inputProof","type":"bytes"},{"internalType":"bytes32","name":"publicKey","type":"bytes32"},{"internalType":"bytes","name":"signature","type":"bytes"}],"name":"bid","outputs":[],"stateMutability":"payable","type":"function"},
            {"inputs":[],"name":"cancelBid","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"cancelDecryption","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"claimRefund","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"BASE_AUCTION_DURATION_BLOCKS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"BATCH_REFUND_SIZE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"BLOCK_TIME","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"DECRYPTION_TIMEOUT_BLOCKS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"EMERGENCY_DELAY_BLOCKS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"EXTENSION_DURATION_BLOCKS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"KMS_THRESHOLD","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"MAX_BIDDERS_PER_ROUND","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"MIN_BID_INCREMENT","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"PLATFORM_FEE_BPS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"pure","type":"function"},
            {"inputs":[],"name":"auctionEndBlock","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"auctionState","outputs":[{"internalType":"enum FHEAuction.AuctionState","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"beneficiary","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"currentLeadBidder","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"currentLeadDeposit","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"currentRound","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"deposits","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"eip712Domain","outputs":[{"internalType":"bytes1","name":"fields","type":"bytes1"},{"internalType":"string","name":"name","type":"string"},{"internalType":"string","name":"version","type":"string"},{"internalType":"uint256","name":"chainId","type":"uint256"},{"internalType":"address","name":"verifyingContract","type":"address"},{"internalType":"bytes32","name":"salt","type":"bytes32"},{"internalType":"uint256[]","name":"extensions","type":"uint256[]"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"feeCollector","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"gatewayContract","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getAuctionInfo","outputs":[{"internalType":"uint256","name":"round","type":"uint256"},{"internalType":"uint256","name":"endBlock","type":"uint256"},{"internalType":"enum FHEAuction.AuctionState","name":"state","type":"uint8"},{"internalType":"uint256","name":"maxDeposit","type":"uint256"},{"internalType":"address","name":"leadBidder","type":"address"},{"internalType":"uint256","name":"validBidders","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"bidder","type":"address"}],"name":"getBidderInfo","outputs":[{"internalType":"uint256","name":"deposit","type":"uint256"},{"internalType":"bool","name":"hasBidded","type":"bool"},{"internalType":"bool","name":"cancelled","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getEstimatedEndTime","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"getRoundBidders","outputs":[{"internalType":"address[]","name":"","type":"address[]"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"address","name":"bidder","type":"address"}],"name":"pendingRefunds","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"totalCollectedFees","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
            {"inputs":[{"internalType":"string","name":"reason","type":"string"}],"name":"emergencyEnd","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"emergencyWithdraw","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"forceFinalize","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"uint256","name":"requestId","type":"uint256"},{"internalType":"bytes","name":"cleartexts","type":"bytes"},{"internalType":"bytes","name":"decryptionProof","type":"bytes"}],"name":"onDecryptionCallback","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"pauseAuction","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},
            {"inputs":[],"name":"requestFinalize","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"unpauseAuction","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"newBeneficiary","type":"address"}],"name":"updateBeneficiary","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[{"internalType":"address","name":"newFeeCollector","type":"address"}],"name":"updateFeeCollector","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"inputs":[],"name":"withdrawPlatformFees","outputs":[],"stateMutability":"nonpayable","type":"function"},
            {"stateMutability":"payable","type":"receive"}
        ];

        // --- TRẠNG THÁI TOÀN CỤC ---
        let provider, signer, account;
        let fheAuctionContract;
        let fhevmInstance = null; 
        let timerInterval; 

        // Các biến trạng thái chính
        let minDepositWei = ethers.BigNumber.from(0); 
        let auctionEndTime = 0; 
        let isFinalized = false;
        let isPaused = false;
        let contractOwner = null; 
        let currentRound = 0;
        let auctionState = 0; // uint8 enum
        let totalFees = 0;
        let pendingRefund = 0;
        let bidderInfo = {};
        let roundBidders = [];

        // --- HÀM TIỆN ÍCH ---
        function formatLogTime() {
            const date = new Date();
            return `[${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}]`;
        }
        
        function logMessage(message, type = 'info') {
            const container = document.getElementById('txContainer');
            const logElement = document.createElement('p');
            logElement.className = `log-line log-${type}`;
            logElement.style.animationDelay = '0s';
            logElement.innerHTML = `<span class="log-time">${formatLogTime()}</span> ${message}`;
            container.prepend(logElement);
            if (container.children.length > 50) {
                container.removeChild(container.lastChild);
            }
        }

        function showNotification(message, type) {
            console.log(`[Notification ${type.toUpperCase()}]: ${message}`);
        }

        // --- TIMER LOGIC ---
        function updateTimerDisplay() {
            const timerElement = document.getElementById('timeLeft');
            const now = Date.now();
            const remaining = auctionEndTime - now;
            const ended = remaining <= 0;

            if (ended) {
                clearInterval(timerInterval);
                timerElement.textContent = 'AUCTION CLOSED!';
                logMessage('[TIMER] Auction end time reached. Checking finalization status...', 'info');
                updateActionButtons();
            } else {
                const totalSeconds = Math.floor(remaining / 1000);
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;

                timerElement.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function startAuctionTimer() {
            if (timerInterval) clearInterval(timerInterval);
            updateTimerDisplay();
            timerInterval = setInterval(updateTimerDisplay, 1000);
        }

        // --- FHE SDK INITIALIZATION ---
        async function initFhevmSdk() {
            const fheStatus = document.getElementById('fheStatus');
            try {
                fheStatus.textContent = '[FHE SDK] Loading SDK from CDN...';
                const mod = await import('https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.js');
                const { initSDK, createInstance, SepoliaConfig } = mod;

                fheStatus.textContent = '[FHE SDK] Initializing WASM files...';
                await initSDK(); 

                fheStatus.textContent = '[FHE SDK] Creating FHE instance...';
                fhevmInstance = await createInstance(SepoliaConfig);

                fheStatus.textContent = '[FHE SDK] Public Key loaded. Ready for encryption.';
                fheStatus.className = 'log-line log-confirmed';
                logMessage('[FHE] SDK initialized successfully. Client-side encryption ready.', 'confirmed');

            } catch (error) {
                console.error("FHE SDK Initialization failed:", error);
                fheStatus.textContent = '[FHE SDK] FAILED. Bid submission is disabled.';
                fheStatus.className = 'log-line log-failed';
                logMessage(`[FATAL] FHE SDK Failed: ${error.message || error}`, 'failed');
            }
        }
        
        // --- CẬP NHẬT GIAO DIỆN HÀNH ĐỘNG ---
        function updateActionButtons() {
            const now = Date.now();
            const isOwner = account && contractOwner && account.toLowerCase() === contractOwner.toLowerCase();
            const emergencyWindowOpen = now >= auctionEndTime + EMERGENCY_DELAY_MS;
            const ended = now >= auctionEndTime;
            const active = auctionState === 0; // Assume 0 = Active
            
            const bidBtn = document.getElementById('bidBtn');
            const cancelBidBtn = document.getElementById('cancelBidBtn');
            const claimRefundBtn = document.getElementById('claimRefundBtn');
            const finalizeBtn = document.getElementById('finalizeBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const cancelDecryptionBtn = document.getElementById('cancelDecryptionBtn');
            const emergencyEndBtn = document.getElementById('emergencyEndBtn');
            const withdrawFeesBtn = document.getElementById('withdrawFeesBtn');
            const batchClaimBtn = document.getElementById('batchClaimBtn');
            const updateBeneficiaryBtn = document.getElementById('updateBeneficiaryBtn');
            const updateFeeCollectorBtn = document.getElementById('updateFeeCollectorBtn');
            
            document.getElementById('ownerActions').style.display = isOwner ? 'block' : 'none';

            // User Bid Actions
            const canBid = account && fhevmInstance && active && !isPaused && !ended && !isFinalized;
            bidBtn.disabled = !canBid;
            bidBtn.textContent = canBid ? '> SUBMIT ENCRYPTED BID $' : (isPaused ? 'PAUSED' : (isFinalized ? 'FINALIZED' : 'AUCTION CLOSED'));

            const canCancelBid = account && bidderInfo.hasBidded && !bidderInfo.cancelled && active && !ended;
            cancelBidBtn.disabled = !canCancelBid;
            cancelBidBtn.style.display = canCancelBid ? 'block' : 'none';

            const canClaimRefund = account && pendingRefund > 0;
            claimRefundBtn.disabled = !canClaimRefund;
            claimRefundBtn.style.display = canClaimRefund ? 'block' : 'none';
            document.getElementById('pendingRefund').textContent = `Pending Refund: ${ethers.utils.formatEther(pendingRefund)} ETH`;

            // Owner Actions
            if (!isOwner) return;

            pauseBtn.disabled = false;
            pauseBtn.textContent = isPaused ? '> UNPAUSE AUCTION' : '> PAUSE AUCTION';

            updateBeneficiaryBtn.disabled = false;
            updateFeeCollectorBtn.disabled = false;

            withdrawFeesBtn.disabled = totalFees <= 0;
            batchClaimBtn.disabled = false;

            if (ended && !isFinalized && !isPaused) {
                finalizeBtn.disabled = false;
                finalizeBtn.textContent = '> REQUEST FINALIZE & REVEAL WINNER';
            } else {
                finalizeBtn.disabled = true;
                finalizeBtn.textContent = isFinalized ? '> FINALIZED' : (isPaused ? 'PAUSED' : '> AWAIT END TIME');
            }

            if (auctionState === 1 && ended) { // Assume 1 = Finalizing
                cancelDecryptionBtn.disabled = false;
                cancelDecryptionBtn.textContent = '> CANCEL DECRYPTION (TIMEOUT)';
            } else {
                cancelDecryptionBtn.disabled = true;
                cancelDecryptionBtn.style.display = 'none';
            }

            if (ended && !isFinalized && emergencyWindowOpen) {
                emergencyEndBtn.disabled = false;
                emergencyEndBtn.textContent = '> EMERGENCY END (+24H DELAY OPEN)';
            } else {
                emergencyEndBtn.disabled = true;
                emergencyEndBtn.style.display = 'none';
            }

            document.getElementById('auctionStatus').textContent = auctionState === 3 ? 'FINALIZED' : (isPaused ? 'PAUSED' : (ended ? 'ENDED' : 'ACTIVE')); // Assume 3 = Finalized
        }

        // --- CONTRACT STATE & EVENTS --- 
        async function getAuctionState() {
            try {
                if (!fheAuctionContract) return;

                const auctionInfo = await fheAuctionContract.getAuctionInfo();
                const [totalFeesWei, ownerAddr] = await Promise.all([
                    fheAuctionContract.totalCollectedFees(),
                    fheAuctionContract.owner()
                ]);

                // Update globals
                currentRound = auctionInfo.round.toNumber();
                auctionEndTime = (auctionInfo.endBlock.toNumber() * 12000); // Approx block time 12s
                auctionState = auctionInfo.state.toNumber();
                isFinalized = auctionState === 3; // Finalized
                contractOwner = ownerAddr;
                totalFees = totalFeesWei;

                // Bidder specific if connected
                if (account) {
                    bidderInfo = await fheAuctionContract.getBidderInfo(account);
                    pendingRefund = await fheAuctionContract.pendingRefunds(account);
                    roundBidders = await fheAuctionContract.getRoundBidders();
                }

                // Update UI
                document.getElementById('minDepositValue').textContent = `${ethers.utils.formatEther(minDepositWei)} ETH`;
                document.getElementById('currentRound').textContent = `#${currentRound}`;
                document.getElementById('leadBidder').textContent = auctionInfo.leadBidder === ethers.constants.AddressZero 
                    ? '0x0000...' : `${auctionInfo.leadBidder.substring(0, 6)}...`;
                document.getElementById('totalFees').textContent = `${ethers.utils.formatEther(totalFees)} ETH`;

                if (isFinalized) {
                    const leadDeposit = await fheAuctionContract.currentLeadDeposit();
                    document.getElementById('currentBid').textContent = `${ethers.utils.formatEther(leadDeposit)} ETH`;
                } else {
                    document.getElementById('currentBid').textContent = 'ENCRYPTED';
                }

                // Update bidder info
                document.getElementById('bidderInfo').innerHTML = `
                    <p>Deposit: ${ethers.utils.formatEther(bidderInfo.deposit)} ETH</p>
                    <p>Has Bidded: ${bidderInfo.hasBidded}</p>
                    <p>Cancelled: ${bidderInfo.cancelled}</p>
                `;

                // Update round bidders
                const biddersList = document.getElementById('roundBidders');
                biddersList.innerHTML = roundBidders.map(addr => `<p>${addr.substring(0, 10)}...</p>`).join('') || '<p>No bidders yet.</p>';

                logMessage('[CONTRACT] State updated: Round, End Block, State, Bidders.', 'info');
                startAuctionTimer();
                updateActionButtons();
                
            } catch (error) {
                console.error("Failed to fetch auction state:", error);
                logMessage(`[ERROR] Failed to fetch state: ${error.message}`, 'failed');
            }
        }

        function listenToEvents() {
            if (!fheAuctionContract) return;
            fheAuctionContract.removeAllListeners();

            fheAuctionContract.on("RoundStarted", (round, endBlock, estimatedEndTime) => {
                logMessage(`[NEW ROUND] #${round.toNumber()} started. Ends ~${new Date(estimatedEndTime.toNumber() * 1000).toLocaleString()}`, 'confirmed');
                getAuctionState();
            });

            fheAuctionContract.on("AuctionFinished", (round, winner, finalBid, platformFee) => {
                logMessage(`[FINISH] Round ${round}: Winner ${winner.substring(0,6)}... Bid: ${ethers.utils.formatEther(finalBid)} ETH (Fee: ${ethers.utils.formatEther(platformFee)})`, 'confirmed');
                getAuctionState();
            });

            fheAuctionContract.on("BidPlaced", (bidder, round, depositAmount, blockNumber) => {
                logMessage(`[BID] Round ${round}: ${bidder.substring(0,6)}... deposited ${ethers.utils.formatEther(depositAmount)} ETH`, 'info');
                getAuctionState();
            });

            fheAuctionContract.on("RefundClaimed", (recipient, amount) => {
                logMessage(`[REFUND] ${recipient.substring(0,6)}... claimed ${ethers.utils.formatEther(amount)} ETH`, 'confirmed');
                getAuctionState();
            });

            fheAuctionContract.on("PlatformFeeCollected", (collector, amount) => {
                logMessage(`[FEES] Collected ${ethers.utils.formatEther(amount)} ETH to ${collector.substring(0,6)}...`, 'info');
                getAuctionState();
            });

            fheAuctionContract.on("StateChanged", (from, to) => {
                logMessage(`[STATE] Changed from ${from} to ${to}`, 'info');
                getAuctionState();
            });

            logMessage('[EVENT] Listeners active for all events.', 'info');
        }

        // --- WALLET & CONNECTION ---
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showNotification('ERROR: MetaMask not detected.', 'error');
                return;
            }

            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: `0x${SEPOLIA_CHAIN_ID.toString(16)}` }],
                });

                provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = provider.getSigner();
                account = await signer.getAddress();
                
                fheAuctionContract = new ethers.Contract(CONTRACT_ADDRESS, FHE_AUCTION_ABI, signer);
                
                minDepositWei = await fheAuctionContract.getMinBidDeposit ? await fheAuctionContract.getMinBidDeposit() : ethers.BigNumber.from(0);
                await getAuctionState();
                listenToEvents();

                document.getElementById('walletStatus').innerHTML = `
                    <p class="log-line log-confirmed">[STATUS] Wallet: CONNECTED & READY</p>
                    <p class="log-line">[ADDRESS] ${account.substring(0, 10)}... ${account.toLowerCase() === contractOwner?.toLowerCase() ? '(OWNER)' : ''}</p>
                    <p class="log-line">[NETWORK] **Sepolia FHEVM**</p>
                `;

                document.getElementById('connectBtn').textContent = '> CONNECTION ESTABLISHED';
                document.getElementById('connectBtn').disabled = true;
                
            } catch (error) {
                console.error(error);
                logMessage(`[ERROR] Connection failed: ${error.message || error}`, 'failed');
            }
        }
        
        // --- BID FUNCTIONS ---
        async function placeBid() {
            const bidBtn = document.getElementById('bidBtn');
            const bidInput = document.getElementById('bidAmount');
            const depositInput = document.getElementById('depositAmount');

            if (!fhevmInstance || !account) { showNotification('FHE SDK not ready or Wallet disconnected.', 'error'); return; }

            try {
                bidBtn.disabled = true;
                const bidEth = parseFloat(bidInput.value);
                const depositEth = parseFloat(depositInput.value);

                if (!bidEth || !depositEth) { throw new Error("Enter both Bid Amount and Deposit."); }

                const bidWei = ethers.utils.parseEther(bidEth.toString());
                const depositWei = ethers.utils.parseEther(depositEth.toString());
                
                if (depositWei.lt(minDepositWei)) {
                    throw new Error(`Deposit must >= ${ethers.utils.formatEther(minDepositWei)} ETH.`);
                }
                if (bidWei.gt(ethers.BigNumber.from("18446744073709551615"))) {
                    throw new Error("Bid exceeds euint64 limit (~18.4 ETH).");
                }
                
                logMessage('[FHE] Encrypting bid...', 'pending');
                const encryptedBid = fhevmInstance.encrypt(bidWei.toString(), 'euint64'); 
                const inputProof = encryptedBid.getProof();
                const publicKey = fhevmInstance.getPublicKey().pubKey;
                
                logMessage('[EIP712] Signing public key...', 'pending');

                const domain = {
                    name: EIP712_DOMAIN_NAME,
                    version: EIP712_DOMAIN_VERSION,
                    chainId: SEPOLIA_CHAIN_ID,
                    verifyingContract: CONTRACT_ADDRESS,
                };
                const types = {
                    PublicKey: [{ name: 'key', type: 'bytes32' }]
                };
                const value = { key: `0x${publicKey}` };
                
                const signature = await signer._signTypedData(domain, types, value);
                
                logMessage('[TX] Submitting bid...', 'pending');
                const tx = await fheAuctionContract.bid(
                    encryptedBid.getEuint64(), 
                    inputProof, 
                    value.key, 
                    signature, 
                    { value: depositWei, gasLimit: 800000 }
                );
                
                logMessage(`[TX:BID] ${tx.hash.substring(0, 10)}... Confirming...`, 'pending');
                await tx.wait(); 
                
                logMessage('[SUCCESS] Bid placed!', 'confirmed');
                showNotification(`Bid: ${bidEth} ETH, Deposit: ${depositEth} ETH`, 'success');
                getAuctionState();
                
            } catch (error) {
                console.error("Bid Failed:", error);
                logMessage(`[ERROR] Bid failed: ${error.message || error.reason}`, 'failed');
                showNotification(`Bid failed: ${error.message || error.reason}`, 'error');
            } finally {
                bidBtn.disabled = false;
            }
        }

        async function cancelBid() {
            try {
                const btn = document.getElementById('cancelBidBtn');
                btn.disabled = true;
                logMessage('[TX] Cancelling bid...', 'pending');
                const tx = await fheAuctionContract.cancelBid({ gasLimit: 300000 });
                await tx.wait();
                logMessage('[SUCCESS] Bid cancelled & refunded.', 'confirmed');
                getAuctionState();
            } catch (error) {
                logMessage(`[ERROR] Cancel failed: ${error.message}`, 'failed');
            } finally {
                btn.disabled = false;
            }
        }

        async function claimRefund() {
            try {
                const btn = document.getElementById('claimRefundBtn');
                btn.disabled = true;
                logMessage('[TX] Claiming refund...', 'pending');
                const tx = await fheAuctionContract.claimRefund({ gasLimit: 300000 });
                await tx.wait();
                logMessage('[SUCCESS] Refund claimed!', 'confirmed');
                getAuctionState();
            } catch (error) {
                logMessage(`[ERROR] Claim failed: ${error.message}`, 'failed');
            } finally {
                btn.disabled = false;
            }
        }

        // --- OWNER FUNCTIONS ---
        async function callOwnerFunction(functionName, params = []) {
            if (!fheAuctionContract || !account) return;
            
            const btn = document.getElementById(functionName + 'Btn') || document.getElementById('finalizeBtn');
            btn.disabled = true;

            try {
                logMessage(`[OWNER] Executing ${functionName}...`, 'pending');
                
                const gasLimit = functionName.includes('Finalize') || functionName.includes('batch') ? 1000000 : 500000;
                const iface = fheAuctionContract.interface;
                const data = iface.encodeFunctionData(functionName, params);

                const tx = await signer.sendTransaction({
                    to: CONTRACT_ADDRESS,
                    data: data,
                    gasLimit: gasLimit, 
                    value: 0
                });
                
                logMessage(`[TX:${functionName.toUpperCase()}] ${tx.hash.substring(0, 10)}...`, 'pending');
                await tx.wait(); 

                logMessage(`[SUCCESS] ${functionName} executed.`, 'confirmed');
                getAuctionState();
                
            } catch (error) {
                const msg = error.reason || error.message.split('execution reverted: ')[1] || "Unknown";
                logMessage(`[ERROR] ${functionName} failed: ${msg}`, 'failed');
            } finally {
                btn.disabled = false;
            }
        }

        async function requestFinalizeAuction() { callOwnerFunction('requestFinalize'); }
        async function togglePauseAuction() { callOwnerFunction(isPaused ? 'unpauseAuction' : 'pauseAuction'); }
        async function cancelDecryption() { callOwnerFunction('cancelDecryption'); }
        async function emergencyEndAuction() { 
            const reason = prompt('Enter emergency reason:') || 'Emergency end requested';
            callOwnerFunction('emergencyEnd', [reason]); 
        }
        async function withdrawPlatformFees() { callOwnerFunction('withdrawPlatformFees'); }
        async function batchClaimRefunds() {
            const claimantsText = document.getElementById('claimantsList').value;
            const claimants = claimantsText.split('\n').map(line => line.trim()).filter(addr => ethers.utils.isAddress(addr));
            if (claimants.length === 0) return showNotification('Enter valid addresses.', 'error');
            callOwnerFunction('batchClaimRefunds', [claimants]);
        }
        async function updateBeneficiary() {
            const newAddr = document.getElementById('newBeneficiary').value;
            if (!ethers.utils.isAddress(newAddr)) return showNotification('Invalid address.', 'error');
            callOwnerFunction('updateBeneficiary', [newAddr]);
        }
        async function updateFeeCollector() {
            const newAddr = document.getElementById('newFeeCollector').value;
            if (!ethers.utils.isAddress(newAddr)) return showNotification('Invalid address.', 'error');
            callOwnerFunction('updateFeeCollector', [newAddr]);
        }

        // --- EVENT LISTENERS INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('connectBtn').addEventListener('click', connectWallet);
            document.getElementById('bidBtn').addEventListener('click', placeBid);
            document.getElementById('cancelBidBtn').addEventListener('click', cancelBid);
            document.getElementById('claimRefundBtn').addEventListener('click', claimRefund);
            document.getElementById('finalizeBtn').addEventListener('click', requestFinalizeAuction); 
            document.getElementById('pauseBtn').addEventListener('click', togglePauseAuction);
            document.getElementById('cancelDecryptionBtn').addEventListener('click', cancelDecryption);
            document.getElementById('emergencyEndBtn').addEventListener('click', emergencyEndAuction);
            document.getElementById('withdrawFeesBtn').addEventListener('click', withdrawPlatformFees);
            document.getElementById('batchClaimBtn').addEventListener('click', batchClaimRefunds);
            document.getElementById('updateBeneficiaryBtn').addEventListener('click', updateBeneficiary);
            document.getElementById('updateFeeCollectorBtn').addEventListener('click', updateFeeCollector);

            await initFhevmSdk();
        });

    </script>
</body>
</html>
